<div class="table-responsive">
<%= form_with(url: destroy_member_path(@space.code), html: { method: :post, novalidate: true, autocomplete: 'off' }, local: true) do |form| %>
  <table class="table table-sm table-hover">
    <thead class="table-light">
      <tr>
<% if @current_member.power_admin? %>
        <th scope="col" class="ps-2 pe-0 pt-0 pb-1">
          <button id="delete_btn" type="submit" class="btn btn-light btn-floating" data-confirm="選択したメンバーを解除しますか？" disabled>
            <i class="fas fa-trash" data-mdb-toggle="tooltip" data-mdb-placement="bottom" title="メンバー解除"></i>
          </button>
        </th>
<% end %>
        <th scope="col" class="text-nowrap">メンバー</th>
<% if @current_member.power_admin? %>
        <th scope="col" class="text-nowrap">
          メールアドレス
          <%= render 'only_icon', power: :admin %>
        </th>
<% end %>
        <th scope="col" class="text-nowrap">権限</th>
<% if @current_member.power_admin? %>
        <th scope="col" class="text-nowrap">
          招待者
          <%= render 'only_icon', power: :admin %>
        </th>
<% end %>
        <th scope="col" class="text-nowrap">
          招待日時
          <i class="fas fa-sort-down"></i>
        </th>
      </tr>
    </thead>
    <tbody>
<% @members.each do |member| %>
<% if !@current_member.power_admin? || member == @current_member %>
      <tr class="align-middle">
<% elsif member.user.code != params[:active] %>
      <tr class="align-middle dblclick_to_link" href="<%= edit_member_path(@space.code, member.user.code) %>">
<% else %>
      <tr class="align-middle table-active dblclick_to_link" href="<%= edit_member_path(@space.code, member.user.code) %>">
<% end %>
<% if @current_member.power_admin? %>
        <%# (メンバー解除) %>
        <td scope="row" class="justify-content-center ps-3 pe-2 py-2">
          <%= form.check_box "codes[#{member.user.code}]", include_hidden: false, class: 'form-check-input change_to_delete_btn_enabled' %>
        </td>
<% end %>
        <%# メンバー %>
        <td scope="row" class="ps-2 pe-1 py-2 ">
          <%= image_tag member.user.image_url(:small), class: 'rounded-circle' %>
          <span class="ms-1">
            <%= member.user.name %>
          </span>
        </td>
<% if @current_member.power_admin? %>
        <%# メールアドレス %>
        <td class="px-1 py-2 ">
          <%= member.user.email %>
        </td>
<% end %>
        <%# 権限 %>
        <td class="text-nowrap px-1 py-2 ">
<% if @current_member.power_admin? && member != @current_member %>
          <a href="<%= edit_member_path(@space.code, member.user.code) %>">
<% end %>
            <i class="fas <%= power_class_name(member.power) %> text-body"></i>
            <%= member.power_i18n %>
<% if @current_member.power_admin? && member != @current_member %>
          </a>
<% end %>
        </td>
<% if @current_member.power_admin? %>
        <%# 招待者 %>
        <td class="px-1 py-2 ">
<% if member.invitation_user.present? %>
          <%= image_tag member.invitation_user.image_url(:small), class: 'rounded-circle' %>
          <span class="fw-bolder ms-1">
            <%= member.invitation_user.name %>
          </span>
<% end %>
        </td>
<% end %>
        <%# 招待日時 %>
        <td class="text-nowrap ps-1 pe-2 py-2 ">
<% if member.invitationed_at.present? %>
          <%= l(member.invitationed_at) %>
<% end %>
        </td>
      </tr>
<% end %>
    </tbody>
  </table>
<% end %>
</div>
